import os
import pandas as pd
import openpyxl
from openpyxl import load_workbook
from openpyxl.utils.cell import range_boundaries
from copy import copy

import connection_postgresql as pg

fPATH = "D:/DATA/PDBbind/index/PDBbind_19444_for_postgresql.xlsx"

load_wb = load_workbook(fPATH, data_only=True)
load_ws = load_wb['Search Results']

db = pg.CRUD()

# columns = [x for row in load_ws.rows for x in row]

list_data = []

idx = 0
col = []
schema = 'pdbbind'
table = 'binding'

for row in load_ws.rows:
    if idx == 0:
        col = [x.value.replace(' ', '_').replace('.','') for x in row]
        col_str = ', '.join(col)
        ### create table
        # structure = []
        # for i, col_name in enumerate(col):
        #     query_tmp = input(f'Type a query for the column {col_name}')
        #     query = f"{col_name} {query_tmp}"
        #     structure.append(query)
        #
        # db.createDB(schema, table, structure)
        ###
        print('done?!')
    else:
        val = [f"\"{str(x.value)}\"" if type(x.value) is str else str(x.value) for x in row]
        val_str = ', '.join(val)
        val_str = val_str.replace('\'', '\\\'')
        val_str = val_str.replace('None', '\'\'')
        val_str = val_str.replace('\"', '\'')
        val_str = val_str.replace('\\\'', '\"')
        db.insertDB(schema, table, col_str, val_str)

    db.commit()
    idx += 1

df_data = pd.DataFrame(list_data, columns=col)

print(f'NULL info\n {df_data.isnull().sum()}')
print(df_data.columns)

'''
@@@ TABLE SCHEMA
Type a query for the column ID integer generated by default as identity Primary Key
Type a query for the column PDB_code char(4) unique NOT NULL
Type a query for the column Subset varchar(10) NOT NULL
Type a query for the column Complex_Type varchar(16) NOT NULL
Type a query for the column Resolution varchar(10) 
Type a query for the column Affinity_Data varchar(20) NOT NULL
Type a query for the column pKd_pKi_pIC50 numeric 
Type a query for the column Release_Year char(4)
Type a query for the column Protein_Name text
Type a query for the column Ligand_Name character varying
Type a query for the column Pubmed_ID character varying
Type a query for the column Pubchem_SID character varying
Type a query for the column EC_number text
Type a query for the column Referencetext
Type a query for the column UniProt_AC text
Type a query for the column Formula character varying
Type a query for the column Molecular_Weight numeric
Type a query for the column Exact_Mass numeric
Type a query for the column No_of_atoms integer
Type a query for the column No_of_bonds integer
Type a query for the column Polar_Surface_Area numeric
Type a query for the column XLOGP3 numeric
Type a query for the column open_banel_LogP numeric
Type a query for the column HB_donor integer
Type a query for the column HB_acceptor integer
Type a query for the column Rotatable_bonds integer
Type a query for the column Canonical_SMILES text
'''